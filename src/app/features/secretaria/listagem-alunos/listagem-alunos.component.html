<section class="painel" [class.loading]="loading()">
  <header class="head">
    <h3 *ngIf="modo === 'SECRETARIA'">Inscritos ({{ total() }})</h3>
    <h3 *ngIf="modo === 'ORIENTADOR'">Selecionar alunos ({{ total() }})</h3>
  </header>

  <!-- Loading -->
  <ng-container *ngIf="loading(); else conteudo">
    <div class="skeleton">
      <div
        class="sk-row"
        *ngFor="let _ of skeletonRows; trackBy: trackByIndex"
      ></div>
    </div>
  </ng-container>

  <ng-template #conteudo>
    <ng-container *ngIf="modo === 'SECRETARIA'">
      <ng-container *ngIf="lista().length; else vazio">
        <ul class="lista" role="list">
          <li
            class="item"
            *ngFor="let a of lista(); trackBy: trackByAlunoSecretaria"
          >
            <div class="aluno-card">
              <div class="dados">
                <strong class="nome" [title]="a.nome">
                  <mat-icon class="avatar-icon">person</mat-icon>
                  <span class="nome-texto">{{ a.nome }}</span>

                  <span
                    *ngIf="a.possuiTrabalhoRemunerado"
                    class="badge remunerado"
                    title="Possui trabalho remunerado"
                  >
                    <mat-icon class="badge-icon">work</mat-icon>
                    Remunerado
                  </span>
                </strong>

                <div class="mini">
                  <span>RA: {{ a.matricula }}</span>
                  <span>Email: {{ a.email }}</span>
                  <span>
                    Status:
                    <b>{{ a.status }}</b>
                  </span>
                </div>

                <div class="links" *ngIf="a.documentoNotasUrl">
                  <a
                    [href]="a.documentoNotasUrl"
                    target="_blank"
                    rel="noopener"
                  >
                    <mat-icon class="link-icon">description</mat-icon>
                    Visualizar Notas
                  </a>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </ng-container>
    </ng-container>

    <!-- ======== MODO ORIENTADOR (seleção) ======== -->
    <ng-container *ngIf="modo === 'ORIENTADOR'">
      <!-- Aprovados -->
      <div *ngIf="aprovadas.length; else nenhumAprovado">
        <h4>Aprovados pela Secretaria</h4>

        <ul class="lista" role="list">
          <li
            class="item"
            *ngFor="
              let i of aprovadas;
              let last = last;
              trackBy: trackByInscricao
            "
          >
            <label class="linha">
              <input
                type="checkbox"
                [checked]="selecionados.has(alunoId(i))"
                [disabled]="disabledCheckbox(i)"
                (change)="onSelecionadoChange($event, i)"
                role="switch"
                [attr.aria-label]="'Selecionar aluno ' + alunoNome(i)"
                [attr.aria-checked]="selecionados.has(alunoId(i))"
                [attr.aria-disabled]="disabledCheckbox(i) ? 'true' : null"
              />

              <div class="dados">
                <strong class="nome" [title]="alunoNome(i)">
                  <mat-icon class="avatar-icon">person</mat-icon>
                  <span class="nome-texto">{{ alunoNome(i) }}</span>

                  <span
                    *ngIf="$any(i)?.possuiTrabalhoRemunerado"
                    class="badge remunerado"
                    title="Possui trabalho remunerado"
                  >
                    <mat-icon class="badge-icon">work</mat-icon>
                    Remunerado
                  </span>
                </strong>

                <div class="mini">
                  <span>RA: {{ alunoRa(i) }}</span>
                  <span class="sep">•</span>
                  <span>Email: {{ alunoEmail(i) }}</span>
                  <span class="sep">•</span>
                  <span>Status: <b>APROVADO</b></span>
                </div>
              </div>
            </label>

            <!-- linha de separação entre alunos -->
            <mat-divider *ngIf="!last"></mat-divider>
          </li>
        </ul>
      </div>

      <ng-template #nenhumAprovado>
        <p class="muted">Nenhum aluno aprovado pela Secretaria ainda.</p>
      </ng-template>

      <!-- Ações -->
      <div class="form-actions" style="margin-top: 12px">
        <button
          type="button"
          (click)="salvarSelecao()"
          [disabled]="
            salvandoSelecao || (limite > 0 && selecionados.size > limite)
          "
        >
          {{ salvandoSelecao ? "Salvando..." : "Salvar seleção" }}
        </button>

        <span class="ok" *ngIf="sucessoSelecao">{{ sucessoSelecao }}</span>
        <span class="erro" *ngIf="erroSalvarSelecao">{{
          erroSalvarSelecao
        }}</span>

        <div class="mini" style="margin-top: 4px">
          Selecionados: {{ selecionados.size }}
          <span *ngIf="limite">/ Limite: {{ limite }}</span>
        </div>
      </div>
    </ng-container>
  </ng-template>

  <!-- Estado vazio (SECRETARIA) -->
  <ng-template #vazio>
    <div class="vazio">
      <h4>Nenhum aluno inscrito ainda</h4>
      <p>Quando houver inscrições neste projeto, elas aparecerão aqui.</p>
    </div>
  </ng-template>
</section>
