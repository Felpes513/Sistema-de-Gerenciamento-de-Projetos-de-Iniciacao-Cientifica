<div class="config-page">
  <h2>Configurações do Sistema</h2>
  <p class="muted">Gerencie campus, cursos e bolsas</p>

  <mat-tab-group>
    <!-- ===== Campus ===== -->
    <mat-tab label="Campus">
      <div class="form-section">
        <h3>Cadastrar Campus</h3>
        <form (ngSubmit)="cadastrarCampus()">
          <input
            type="text"
            [(ngModel)]="novoCampus"
            name="nomeCampus"
            placeholder="Nome do campus"
            required
          />
          <button type="submit">Salvar</button>
        </form>

        <h4>Campus cadastrados</h4>
        <ul class="list">
          <li *ngFor="let c of campus">
            <span>{{ c.campus }}</span>
            <button class="danger" (click)="excluirCampus(c.id_campus)">
              Excluir
            </button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <!-- ===== Cursos ===== -->
    <mat-tab label="Cursos">
      <div class="form-section">
        <h3>Cadastrar Curso</h3>
        <form (ngSubmit)="cadastrarCurso()">
          <input
            type="text"
            [(ngModel)]="novoCurso"
            name="nomeCurso"
            placeholder="Nome do curso"
            required
          />
          <button type="submit">Salvar</button>
        </form>

        <h4>Cursos cadastrados</h4>
        <ul class="list">
          <li *ngFor="let c of cursos">
            <span>{{ c.nome }}</span>
            <button class="danger" (click)="excluirCurso(c.id_curso)">
              Excluir
            </button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <mat-tab label="Bolsas">
      <div class="form-section">
        <!-- ============================================= -->
        <!--  TIPOS DE BOLSA (CADASTRO)                    -->
        <!-- ============================================= -->
        <h3>Cadastrar Tipo de Bolsa</h3>

        <form (ngSubmit)="criarTipoBolsa()" class="crud-inline">
          <input
            type="text"
            [(ngModel)]="novoTipoBolsa"
            name="tipoBolsa"
            placeholder="Ex: PIBIC, PIBITI, Voluntária..."
            required
          />
          <button type="submit">Salvar</button>
        </form>

        <h4>Tipos de Bolsa Cadastrados</h4>
        <ul class="list">
          <li *ngFor="let t of tiposBolsa">
            <span>{{ t.tipo_bolsa }}</span>
            <button class="danger" (click)="excluirTipoBolsa(t.id_tipo_bolsa)">
              Excluir
            </button>
          </li>
        </ul>

        <hr class="section-divider" />

        <h3>Atribuição de Bolsa para Alunos</h3>

        <div class="bolsas-filter">
          <input
            type="text"
            [(ngModel)]="filtroBolsa"
            placeholder="Filtrar por nome ou e-mail"
          />
        </div>

        <!-- wrapper com scroll -->
        <div class="table-bolsas-wrapper" *ngIf="alunos.length">
          <table class="table table-bolsas">
            <thead>
              <tr>
                <th>Aluno</th>
                <th>Email</th>
                <th>Bolsas Atuais</th>
                <th>Ações</th>
              </tr>
            </thead>

            <tbody>
              <tr
                *ngFor="let a of alunos"
                [hidden]="!matchBolsa(filtroBolsa, a.nome_completo, a.email)"
              >
                <td>{{ toTitleCase(a.nome_completo) }}</td>
                <td>{{ a.email }}</td>

                <!-- bolsas -->
                <td>
                  <div *ngIf="a.bolsas.length; else semBolsa">
                    <span *ngFor="let b of a.bolsas" class="tag">
                      {{ b.tipo_bolsa }}
                      <button
                        class="tag-remove"
                        (click)="removerBolsa(b.id_bolsa)"
                      >
                        x
                      </button>
                    </span>
                  </div>

                  <ng-template #semBolsa>
                    <span class="muted">Nenhuma bolsa</span>
                  </ng-template>
                </td>

                <td>
                  <button (click)="abrirSelecaoBolsa(a)">Vincular Bolsa</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="modal-backdrop" *ngIf="modalBolsaAberto">
        <div class="modal">
          <h3>Vincular Bolsa</h3>
          <p>
            Aluno:<strong>{{
              toTitleCase(alunoSelecionado?.nome_completo)
            }}</strong>
          </p>

          <select [(ngModel)]="bolsaSelecionada" name="tiposBolsaSelect">
            <option [ngValue]="null" disabled selected>
              Selecione o tipo de bolsa
            </option>
            <option *ngFor="let t of tiposBolsa" [ngValue]="t.id_tipo_bolsa">
              {{ t.tipo_bolsa }}
            </option>
          </select>

          <div class="modal-actions">
            <button (click)="confirmarVinculo()">Salvar</button>
            <button class="danger" (click)="fecharModal()">Cancelar</button>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
