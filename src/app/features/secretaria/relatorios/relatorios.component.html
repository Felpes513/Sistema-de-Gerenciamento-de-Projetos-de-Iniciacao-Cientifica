<h2>Relatórios Mensais</h2>

<div class="toolbar">
  <div class="mes-picker">
    <label for="mesRef">Mês de referência</label>

    <div class="controls">
      <button
        type="button"
        class="btn-icon"
        (click)="mudarMes(-1)"
        [disabled]="carregandoMensal"
        aria-label="Mês anterior"
      >
        <mat-icon>chevron_left</mat-icon>
      </button>

      <input
        id="mesRef"
        type="month"
        [(ngModel)]="mes"
        (ngModelChange)="atualizarMes()"
        [disabled]="carregandoMensal"
      />

      <button
        type="button"
        class="btn-icon"
        (click)="mudarMes(1)"
        [disabled]="carregandoMensal"
        aria-label="Próximo mês"
      >
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>
</div>

<section class="card">
  <header>
    <h3><mat-icon>check_circle</mat-icon> Recebidos no mês</h3>
    <span class="badge">{{ recebidos.length }}</span>
  </header>

  <div *ngIf="!recebidos.length && !carregandoMensal" class="empty">
    Nenhum relatório confirmado para {{ mes }}.
  </div>

  <div
    class="table-scroll"
    *ngIf="recebidos.length"
    tabindex="0"
    aria-label="Tabela de relatórios recebidos com rolagem horizontal"
  >
    <div class="scroller">
      <table>
        <thead>
          <tr>
            <th>Projeto</th>
            <th>Orientador</th>
            <th>Mês</th>
            <th>Status</th>
            <th>Confirmado em</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let r of recebidos"
            class="row-link"
            (click)="abrirDetalhe(r)"
            tabindex="0"
            (keyup.enter)="abrirDetalhe(r)"
          >
            <td class="left">{{ r.tituloProjeto }}</td>
            <td>{{ r.orientadorNome || "—" }}</td>
            <td class="nowrap">{{ r.referenciaMes }}</td>
            <td class="nowrap">
              <span class="status" [class.ok]="r.ok" [class.nok]="!r.ok">
                {{ r.ok ? "OK" : "Pendente" }}
              </span>
            </td>
            <td class="nowrap">{{ dataBr(r.confirmadoEm) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<section class="card">
  <header>
    <h3><mat-icon>error</mat-icon> Pendências no mês</h3>
    <span class="badge warn">{{ pendentes.length }}</span>
  </header>

  <div *ngIf="!pendentes.length && !carregandoMensal" class="empty">
    Nenhuma pendência para {{ mes }}.
  </div>

  <div
    class="table-scroll"
    *ngIf="pendentes.length"
    tabindex="0"
    aria-label="Tabela de relatórios pendentes com rolagem horizontal"
  >
    <div class="scroller">
      <table>
        <thead>
          <tr>
            <th>Projeto</th>
            <th>Orientador</th>
            <th>Mês</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of pendentes">
            <td class="left">{{ p.tituloProjeto }}</td>
            <td>{{ p.orientadorNome || "—" }}</td>
            <td class="nowrap">{{ p.mes || mes }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
