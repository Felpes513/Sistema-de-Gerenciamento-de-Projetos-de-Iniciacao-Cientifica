<!-- src/app/features/orientador/relatorio-form/relatorio-form.component.html -->
<section class="painel">
  <header class="head">
    <div class="titlebar">
      <h3>Relatório mensal — Projeto #{{ projetoId }}</h3>

      <!-- Botão fechar (topo) -->
      <button
        type="button"
        class="btn-icon close-btn"
        (click)="fechar()"
        aria-label="Fechar formulário"
        title="Fechar"
      >
        <i class="fas fa-xmark"></i>
      </button>
    </div>
    <p class="muted">Preencha o resumo do mês e confirme o envio.</p>
  </header>

  <div class="grid">
    <form [formGroup]="form" (ngSubmit)="salvar()">
      <div class="row">
        <label>Mês de Referência</label>
        <input type="month" formControlName="referenciaMes" />
      </div>

      <div class="row" *ngIf="relatorioEnviadoDoMes()">
        <div class="hint">
          ✅ Já existe relatório enviado para
          <strong>{{ relatorioEnviadoDoMes()!.referenciaMes }}</strong
          >.
        </div>
      </div>

      <div class="row">
        <label>Resumo do Progresso</label>
        <textarea
          rows="4"
          formControlName="resumo"
          placeholder="Principais avanços do mês"
        ></textarea>
      </div>

      <div class="row">
        <label>Atividades Realizadas</label>
        <textarea rows="3" formControlName="atividades"></textarea>
      </div>

      <div class="row">
        <label>Bloqueios/Impedimentos</label>
        <textarea rows="3" formControlName="bloqueios"></textarea>
      </div>

      <div class="row">
        <label>Próximos Passos</label>
        <textarea rows="3" formControlName="proximosPassos"></textarea>
      </div>

      <div class="row">
        <label>Horas no Mês</label>
        <input type="number" min="0" step="1" formControlName="horas" />
      </div>

      <div class="row">
        <label>
          <input type="checkbox" formControlName="ok" />
          Declaro que revisei os dados e confirmo o relatório do mês.
        </label>
      </div>

      <!-- Ações: Fechar sempre visível; Confirmar só se não for readOnly -->
      <div class="actions">
        <button type="button" class="btn-secondary" (click)="fechar()">
          <i class="fas fa-arrow-left"></i> Fechar
        </button>

        <button *ngIf="!readOnly" type="submit" [disabled]="salvando()">
          <i class="fas fa-save"></i> Confirmar relatório
        </button>
      </div>
    </form>

    <aside class="lista-relatorios">
      <h4>Status do mês selecionado</h4>
      <ng-container *ngIf="relatorioEnviadoDoMes(); else pendente">
        <p>
          Relatório <strong>enviado</strong> em
          {{ dataBr(relatorioEnviadoDoMes()!.confirmadoEm) }}.
        </p>
        <p><small>Observação salva:</small></p>
        <pre
          style="
            white-space: pre-wrap;
            font-size: 0.9rem;
            margin: 0.25rem 0 0 0;
          "
          >{{ relatorioEnviadoDoMes()!.observacao || "—" }}</pre
        >
      </ng-container>
      <ng-template #pendente>
        <p class="muted">Nenhum relatório enviado para o mês selecionado.</p>
      </ng-template>
    </aside>
  </div>
</section>
