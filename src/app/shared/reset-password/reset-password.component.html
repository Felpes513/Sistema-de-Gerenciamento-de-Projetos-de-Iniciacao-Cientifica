<div class="reset-card">
  <h2 *ngIf="!token">Redefinir senha</h2>
  <h2 *ngIf="token">Definir nova senha</h2>

  <ng-container *ngIf="!token">
    <p class="muted">
      Informe seu e-mail. Enviaremos um link para redefinição.
    </p>

    <form (ngSubmit)="enviar()">
      <div class="field">
        <label>E-mail</label>
        <input
          type="email"
          [(ngModel)]="email"
          name="email"
          placeholder="seu.email@exemplo.com"
          required
        />
      </div>

      <button type="submit" class="btn" [disabled]="loading">
        Enviar link de redefinição
      </button>

      <div class="alert ok" *ngIf="okMsg">
        <mat-icon>check_circle</mat-icon> {{ okMsg }}
      </div>
      <div class="alert err" *ngIf="erro">
        <mat-icon>warning_amber</mat-icon> {{ erro }}
      </div>
    </form>
  </ng-container>

  <ng-container *ngIf="token">
    <p class="muted">Crie sua nova senha para acessar o portal.</p>

    <form (ngSubmit)="salvarNovaSenha()">
      <div class="field">
        <label>Nova senha</label>
        <input
          [type]="show1 ? 'text' : 'password'"
          [(ngModel)]="novaSenha"
          name="novaSenha"
          placeholder="••••••••"
          required
          minlength="8"
        />
        <button
          type="button"
          class="toggle-password"
          (click)="show1 = !show1"
          aria-label="Mostrar/ocultar senha"
        >
          <mat-icon>{{ show1 ? "visibility_off" : "visibility" }}</mat-icon>
        </button>
      </div>

      <div class="field">
        <label>Confirmar nova senha</label>
        <input
          [type]="show2 ? 'text' : 'password'"
          [(ngModel)]="confirmacao"
          name="confirmacao"
          placeholder="••••••••"
          required
          minlength="8"
        />
        <button
          type="button"
          class="toggle-password"
          (click)="show2 = !show2"
          aria-label="Mostrar/ocultar senha"
        >
          <mat-icon>{{ show2 ? "visibility_off" : "visibility" }}</mat-icon>
        </button>
      </div>

      <div class="field-hint" *ngIf="!senhaConfere() && confirmacao">
        <mat-icon>info</mat-icon> As senhas não conferem.
      </div>

      <button
        type="submit"
        class="btn"
        [disabled]="loading || !senhaConfere() || !strongEnough()"
      >
        Salvar nova senha
      </button>

      <div class="alert ok" *ngIf="okMsg">
        <mat-icon>check_circle</mat-icon> {{ okMsg }}
      </div>
      <div class="alert err" *ngIf="erro">
        <mat-icon>warning_amber</mat-icon> {{ erro }}
      </div>
    </form>

    <div class="links" *ngIf="!loading">
      <a (click)="irParaLogin()" style="cursor: pointer">Ir para o login</a>
    </div>
  </ng-container>

  <div class="links" *ngIf="!token">
    <a (click)="voltarLogin()" style="cursor: pointer">Voltar ao login</a>
  </div>
</div>
