<div class="auth-wrapper">
  <aside class="auth-left">
    <div class="brand only-logo">
      <img src="/assets/Logo.jpg" alt="USCS" />
    </div>
  </aside>

  <section class="auth-right">
    <header class="header">
      <h1>Bem Vindo ao SGPIC!</h1>
      <p>Crie sua conta</p>
    </header>

    <div class="perfil-toggle" *ngIf="!perfilSelecionado">
      <button (click)="selecionarPerfil('orientador')" class="toggle-btn">
        <mat-icon>school</mat-icon> Sou Orientador
      </button>
      <button (click)="selecionarPerfil('aluno')" class="toggle-btn alt">
        <mat-icon>person</mat-icon> Sou Aluno
      </button>
    </div>

    <form
      *ngIf="perfilSelecionado === 'orientador'"
      (ngSubmit)="onSubmitOrientador()"
      #formOri="ngForm"
      class="form"
    >
      <div class="form-row">
        <input
          type="text"
          name="ori_nome"
          [(ngModel)]="ori.nomeCompleto"
          placeholder="Nome completo"
          required
        />
      </div>

      <div class="form-row">
        <input
          type="text"
          name="ori_cpf"
          [(ngModel)]="ori.cpf"
          (blur)="touchCpf('ori'); applyCpfMask('ori')"
          placeholder="CPF"
          required
          [class.invalid]="cpfOriTouched && !isCpfValido(ori.cpf)"
        />
        <small class="field-error" *ngIf="cpfOriTouched && !isCpfValido(ori.cpf)">
          CPF inválido
        </small>
      </div>

      <div class="form-row">
        <input
          type="email"
          name="ori_email"
          [(ngModel)]="ori.email"
          placeholder="E-mail"
          required
        />
      </div>

      <div class="form-row">
        <input
          [type]="showPassOri ? 'text' : 'password'"
          name="ori_senha"
          [(ngModel)]="ori.senha"
          (blur)="touchSenha('ori')"
          placeholder="Senha"
          minlength="6"
          required
          [class.invalid]="senhaOriTouched && ori.senha && ori.senha.length < 6"
        />
        <small
          class="field-error"
          *ngIf="senhaOriTouched && ori.senha && ori.senha.length < 6"
        >
          A senha deve ter no mínimo 6 caracteres
        </small>
      </div>

      <div class="form-row">
        <input
          [type]="showPassOri ? 'text' : 'password'"
          name="ori_confirma"
          [(ngModel)]="ori.confirmar"
          (blur)="touchConfirmar('ori')"
          placeholder="Confirmar senha"
          required
          [class.invalid]="
            confirmarOriTouched &&
            !!ori.confirmar &&
            ori.senha !== ori.confirmar
          "
        />
        <small
          class="field-error"
          *ngIf="
            confirmarOriTouched &&
            !!ori.confirmar &&
            ori.senha !== ori.confirmar
          "
        >
          As senhas não conferem
        </small>
      </div>

      <label class="terms">
        <input
          type="checkbox"
          [(ngModel)]="acceptTermsOri"
          name="termsOri"
          required
        />
        <span>Eu concordo com os termos de serviço</span>
      </label>

      <button
        type="submit"
        class="cta"
        [disabled]="isLoading || !acceptTermsOri || ori.senha !== ori.confirmar"
      >
        Cadastrar
      </button>

      <div class="msg erro" *ngIf="erro">{{ erro }}</div>
      <div class="msg sucesso" *ngIf="sucesso">{{ sucesso }}</div>
    </form>

    <form
      *ngIf="perfilSelecionado === 'aluno'"
      (ngSubmit)="onSubmitAluno()"
      class="form"
    >
      <ng-container *ngIf="step === 1">
        <div class="form-row">
          <input
            type="text"
            name="alu_nome"
            [(ngModel)]="alu.nomeCompleto"
            placeholder="Nome completo"
            required
          />
        </div>

        <div class="form-row">
          <input
            type="text"
            name="alu_cpf"
            [(ngModel)]="alu.cpf"
            (blur)="touchCpf('alu'); applyCpfMask('alu')"
            placeholder="CPF"
            required
            [class.invalid]="cpfAluTouched && !isCpfValido(alu.cpf)"
          />
          <small class="field-error" *ngIf="cpfAluTouched && !isCpfValido(alu.cpf)">
            CPF inválido
          </small>
        </div>

        <div class="form-row">
          <input
            type="email"
            name="alu_email"
            [(ngModel)]="alu.email"
            placeholder="E-mail"
            required
          />
        </div>

        <div class="form-row">
          <input
            [type]="showPassAlu ? 'text' : 'password'"
            name="alu_senha"
            [(ngModel)]="alu.senha"
            (blur)="touchSenha('alu')"
            placeholder="Senha"
            minlength="6"
            required
            [class.invalid]="senhaAluTouched && alu.senha && alu.senha.length < 6"
          />
          <small
            class="field-error"
            *ngIf="senhaAluTouched && alu.senha && alu.senha.length < 6"
          >
            A senha deve ter no mínimo 6 caracteres
          </small>
        </div>

        <div class="form-row">
          <input
            [type]="showPassAlu ? 'text' : 'password'"
            name="alu_confirma"
            [(ngModel)]="alu.confirmar"
            (blur)="touchConfirmar('alu')"
            placeholder="Confirmar senha"
            required
            [class.invalid]="
              confirmarAluTouched &&
              !!alu.confirmar &&
              alu.senha !== alu.confirmar
            "
          />
          <small
            class="field-error"
            *ngIf="
              confirmarAluTouched &&
              !!alu.confirmar &&
              alu.senha !== alu.confirmar
            "
          >
            As senhas não conferem
          </small>
        </div>

        <div class="form-actions">
          <button
            type="button"
            class="cta"
            (click)="goStep(2)"
            [disabled]="!validStep1()"
          >
            Próximo
          </button>
        </div>
      </ng-container>

      <ng-container *ngIf="step === 2">
        <div class="form-row">
          <select name="alu_curso" [(ngModel)]="alu.idCurso" required>
            <option value="" disabled selected>Selecione o curso</option>
            <option *ngFor="let c of cursos" [value]="c.id_curso">
              {{ c.nome }}
            </option>
          </select>
        </div>

        <div class="form-row">
          <select name="alu_campus" [(ngModel)]="alu.idCampus">
            <option value="" disabled selected>Selecione o campus</option>
            <option *ngFor="let c of campus" [value]="c.id_campus">
              {{ c.campus }}
            </option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="ghost" (click)="goStep(1)">
            <mat-icon>arrow_back</mat-icon> Voltar
          </button>
          <button
            type="button"
            class="cta"
            (click)="goStep(3)"
            [disabled]="!alu.idCurso"
          >
            Próximo
          </button>
        </div>
      </ng-container>

      <ng-container *ngIf="step === 3">
        <div class="upload">
          <label class="file" [class.invalid]="pdfTouched && !pdfFile">
            <input
              type="file"
              (change)="onPdfChange($event)"
              accept="application/pdf"
            />
            <span>
              {{
                pdfName
                  ? ('Arquivo selecionado: ' + pdfName)
                  : 'Enviar notas em PDF'
              }}
            </span>
          </label>

          <small *ngIf="!pdfName">Somente .pdf</small>
          <small class="ok" *ngIf="pdfName">✅ PDF anexado com sucesso</small>
          <small class="field-error" *ngIf="pdfTouched && !pdfFile">
            Envie um PDF válido
          </small>
        </div>

        <div class="form-row inline">
          <label class="radio">
            <input
              type="radio"
              name="alu_remunerado"
              [(ngModel)]="alu.possuiTrabalhoRemunerado"
              [value]="true"
              required
            />
            <span>Possui trabalho remunerado</span>
          </label>

          <label class="radio">
            <input
              type="radio"
              name="alu_remunerado"
              [(ngModel)]="alu.possuiTrabalhoRemunerado"
              [value]="false"
              required
            />
            <span>Não possui</span>
          </label>
        </div>

        <label class="terms">
          <input
            type="checkbox"
            [(ngModel)]="acceptTermsAlu"
            name="termsAlu"
            required
          />
          <span>Eu concordo com os termos de serviço</span>
        </label>

        <div class="form-actions">
          <button type="button" class="ghost" (click)="goStep(2)">
            <mat-icon>arrow_back</mat-icon> Voltar
          </button>
          <button
            type="submit"
            class="cta"
            [disabled]="isLoading || !pdfFile || !acceptTermsAlu"
          >
            Cadastrar
          </button>
        </div>
      </ng-container>

      <div class="msg erro" *ngIf="erro">{{ erro }}</div>
      <div class="msg sucesso" *ngIf="sucesso">{{ sucesso }}</div>
    </form>
  </section>
</div>
